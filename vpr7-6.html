<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: white;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-size: 1.6rem;
      }

      .back-link {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 25px;
        margin-bottom: 20px;
        transition: background 0.3s;
      }

      .back-link:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .instructions {
        background: rgba(255, 255, 255, 0.95);
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 0.95rem;
        color: #333;
      }

      .task-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .task-text {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #333;
        margin-bottom: 25px;
      }

      .task-text .highlight {
        background: linear-gradient(145deg, #4ca1af 0%, #2c3e50 100%);
        color: white;
        padding: 2px 8px;
        border-radius: 5px;
        font-weight: bold;
      }

      .message-display {
        background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
        color: #00ff88;
        padding: 20px;
        border-radius: 10px;
        font-family: "Courier New", monospace;
        font-size: 1.5rem;
        text-align: center;
        margin: 20px 0;
        letter-spacing: 3px;
        word-break: break-all;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .codes-table-container {
        overflow-x: auto;
        margin: 20px 0;
      }

      .codes-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .codes-table th {
        background: linear-gradient(145deg, #4ca1af 0%, #2c3e50 100%);
        color: white;
        padding: 12px 15px;
        font-weight: 600;
        text-align: center;
      }

      .codes-table td {
        border: 1px solid #e0e0e0;
        padding: 10px 15px;
        text-align: center;
        font-size: 1rem;
      }

      .codes-table td.letter {
        font-weight: bold;
        font-size: 1.2rem;
        color: #2c3e50;
        background: rgba(76, 161, 175, 0.1);
      }

      .codes-table td.code {
        font-family: "Courier New", monospace;
        color: #4ca1af;
        font-weight: bold;
        letter-spacing: 2px;
      }

      .answer-section {
        margin-top: 25px;
        text-align: center;
      }

      .answer-label {
        font-size: 1.1rem;
        color: #333;
        margin-bottom: 10px;
        display: block;
      }

      .answer-input {
        width: 100%;
        max-width: 300px;
        padding: 15px 20px;
        font-size: 1.2rem;
        border: 3px solid #e0e0e0;
        border-radius: 10px;
        text-align: center;
        text-transform: uppercase;
        transition: border-color 0.3s;
      }

      .answer-input:focus {
        outline: none;
        border-color: #4ca1af;
      }

      .answer-input.correct {
        border-color: #38ef7d;
        background: rgba(56, 239, 125, 0.1);
      }

      .answer-input.incorrect {
        border-color: #f45c43;
        background: rgba(244, 92, 67, 0.1);
      }

      .buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .btn {
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1rem;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        font-weight: 500;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn-check {
        background: linear-gradient(145deg, #11998e 0%, #38ef7d 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
      }

      .btn-hint {
        background: linear-gradient(145deg, #f093fb 0%, #f5576c 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
      }

      .btn-reset {
        background: linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .feedback {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        font-weight: bold;
        display: none;
      }

      .feedback.correct {
        display: block;
        background: linear-gradient(145deg, #11998e 0%, #38ef7d 100%);
        color: white;
      }

      .feedback.incorrect {
        display: block;
        background: linear-gradient(145deg, #eb3349 0%, #f45c43 100%);
        color: white;
      }

      .hint-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px 20px;
        margin-top: 20px;
        border-radius: 0 10px 10px 0;
        display: none;
      }

      .hint-box h4 {
        color: #856404;
        margin-bottom: 10px;
      }

      .hint-step {
        margin: 10px 0;
        padding: 10px 15px;
        background: rgba(255, 193, 7, 0.1);
        border-radius: 8px;
        font-family: "Courier New", monospace;
      }

      .hint-step .code-part {
        color: #d63384;
        font-weight: bold;
      }

      .hint-step .letter-part {
        color: #198754;
        font-weight: bold;
      }

      .hint-step .remaining {
        color: #6c757d;
      }

      .direction-hint {
        font-size: 0.9rem;
        color: #856404;
        margin-bottom: 15px;
        padding: 8px 12px;
        background: rgba(255, 193, 7, 0.2);
        border-radius: 5px;
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 1.3rem;
        }

        .task-text {
          font-size: 1rem;
        }

        .message-display {
          font-size: 1.2rem;
          padding: 15px;
        }

        .codes-table td {
          padding: 8px 10px;
          font-size: 0.9rem;
        }

        .btn {
          padding: 10px 20px;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="vpr7.html" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
      <h1>üìª –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</h1>

      <div class="instructions">
        –†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–∞–±–ª–∏—Ü—É –∫–æ–¥–æ–≤. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å
        –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º —Å –Ω–∞—á–∞–ª–∞ –∏–ª–∏ —Å –∫–æ–Ω—Ü–∞.
      </div>

      <div class="task-card">
        <div class="task-text" id="taskText">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏—è...</div>

        <div class="message-display" id="messageDisplay">...</div>

        <div class="codes-table-container">
          <table class="codes-table" id="codesTable">
            <thead>
              <tr id="codesHeader"></tr>
            </thead>
            <tbody>
              <tr id="codesLetters"></tr>
              <tr id="codesValues"></tr>
            </tbody>
          </table>
        </div>

        <div class="answer-section">
          <label class="answer-label">–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
          <input
            type="text"
            class="answer-input"
            id="answerInput"
            placeholder="–í–ê–® –û–¢–í–ï–¢"
            autocomplete="off"
          />
        </div>

        <div class="hint-box" id="hintBox">
          <h4>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ ‚Äî –ø–æ—à–∞–≥–æ–≤–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:</h4>
          <div class="direction-hint" id="directionHint"></div>
          <div id="hintSteps"></div>
        </div>

        <div class="feedback" id="feedback">
          <div id="feedbackText"></div>
        </div>

        <div class="buttons">
          <button class="btn btn-check" onclick="checkAnswer()">
            ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
          </button>
          <button class="btn btn-hint" onclick="showHint()">
            üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞
          </button>
          <button class="btn btn-reset" onclick="resetGame()">
            üîÑ –ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
          </button>
        </div>
      </div>
    </div>

    <script>
      let codeSets = {};
      let currentTask = null;
      let answered = false;

      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
      async function loadData() {
        try {
          const response = await fetch("vpr7-6.txt");
          const text = await response.text();
          parseData(text);
          startGame();
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
          // Fallback –¥–∞–Ω–Ω—ã–µ
          codeSets = {
            MORSE: {
              symbols: ["‚Ä¢", "‚Äì"],
              codes: {
                –ê: "‚Ä¢‚Äì",
                –í: "‚Ä¢‚Äì‚Äì",
                –õ: "‚Ä¢‚Äì‚Ä¢‚Ä¢",
                –û: "‚Äì‚Äì‚Äì",
                –ü: "‚Ä¢‚Äì‚Äì‚Ä¢",
                –†: "‚Ä¢‚Äì‚Ä¢",
              },
            },
          };
          startGame();
        }
      }

      // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
      function parseData(text) {
        const lines = text.split("\n");
        let currentSet = null;
        let currentSymbols = [];

        lines.forEach((line) => {
          line = line.trim();
          if (line.startsWith("@")) {
            // –ù–æ–≤—ã–π –Ω–∞–±–æ—Ä –∫–æ–¥–æ–≤
            const parts = line.substring(1).split(/\s+/);
            const setName = parts[0];
            currentSymbols = parts.slice(1);
            currentSet = setName;
            codeSets[setName] = {
              symbols: currentSymbols,
              codes: {},
            };
          } else if (line && currentSet && !line.startsWith("#")) {
            // –ë—É–∫–≤–∞ –∏ –∫–æ–¥
            const parts = line.split(/\s+/);
            if (parts.length >= 2) {
              const letter = parts[0];
              const code = parts[1];
              codeSets[currentSet].codes[letter] = code;
            }
          }
        });
      }

      // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
      function startGame() {
        generateTask();
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º–æ–≥–æ —É—Å–ª–æ–≤–∏—è –§–∞–Ω–æ
      function checkDirectFano(codes) {
        const codeList = Object.values(codes);
        for (let i = 0; i < codeList.length; i++) {
          for (let j = 0; j < codeList.length; j++) {
            if (i !== j && codeList[j].startsWith(codeList[i])) {
              return false;
            }
          }
        }
        return true;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è –§–∞–Ω–æ
      function checkReverseFano(codes) {
        const codeList = Object.values(codes);
        for (let i = 0; i < codeList.length; i++) {
          for (let j = 0; j < codeList.length; j++) {
            if (i !== j && codeList[j].endsWith(codeList[i])) {
              return false;
            }
          }
        }
        return true;
      }

      // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–∞—á–∞–ª–∞
      function decodeFromStart(message, codes) {
        let result = "";
        let remaining = message;

        while (remaining.length > 0) {
          let found = false;
          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–¥—ã –ø–æ –¥–ª–∏–Ω–µ (–æ—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫ –¥–ª–∏–Ω–Ω—ã–º)
          const sortedCodes = Object.entries(codes).sort(
            (a, b) => a[1].length - b[1].length,
          );

          for (const [letter, code] of sortedCodes) {
            if (remaining.startsWith(code)) {
              result += letter;
              remaining = remaining.substring(code.length);
              found = true;
              break;
            }
          }

          if (!found) {
            return null; // –ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å
          }
        }

        return result;
      }

      // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ü–∞
      function decodeFromEnd(message, codes) {
        let result = "";
        let remaining = message;

        while (remaining.length > 0) {
          let found = false;
          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–¥—ã –ø–æ –¥–ª–∏–Ω–µ (–æ—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫ –¥–ª–∏–Ω–Ω—ã–º)
          const sortedCodes = Object.entries(codes).sort(
            (a, b) => a[1].length - b[1].length,
          );

          for (const [letter, code] of sortedCodes) {
            if (remaining.endsWith(code)) {
              result = letter + result;
              remaining = remaining.substring(
                0,
                remaining.length - code.length,
              );
              found = true;
              break;
            }
          }

          if (!found) {
            return null; // –ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å
          }
        }

        return result;
      }

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è
      function generateTask() {
        answered = false;
        document.getElementById("feedback").className = "feedback";
        document.getElementById("feedback").style.display = "none";
        document.getElementById("hintBox").style.display = "none";
        document.getElementById("answerInput").value = "";
        document.getElementById("answerInput").className = "answer-input";

        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–¥–æ–≤
        const setNames = Object.keys(codeSets);
        const randomSet = setNames[Math.floor(Math.random() * setNames.length)];
        const codeSet = codeSets[randomSet];

        // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ –±—É–∫–≤ (5-6 —à—Ç—É–∫), —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–µ–µ —É—Å–ª–æ–≤–∏—é –§–∞–Ω–æ
        const allLetters = Object.keys(codeSet.codes);
        let selectedLetters = [];
        let selectedCodes = {};

        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        const maxAttempts = 100;
        let attempts = 0;

        while (attempts < maxAttempts) {
          attempts++;

          // –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º 5-6 –±—É–∫–≤
          const shuffled = [...allLetters].sort(() => Math.random() - 0.5);
          selectedLetters = shuffled.slice(
            0,
            5 + Math.floor(Math.random() * 2),
          );
          selectedCodes = {};
          selectedLetters.forEach((letter) => {
            selectedCodes[letter] = codeSet.codes[letter];
          });

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –§–∞–Ω–æ
          const directFano = checkDirectFano(selectedCodes);
          const reverseFano = checkReverseFano(selectedCodes);

          if (directFano || reverseFano) {
            break;
          }
        }

        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é, –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 5 –±—É–∫–≤
        if (attempts >= maxAttempts) {
          selectedLetters = allLetters.slice(0, 5);
          selectedCodes = {};
          selectedLetters.forEach((letter) => {
            selectedCodes[letter] = codeSet.codes[letter];
          });
        }

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ–≤–æ –∏–∑ 4-5 –±—É–∫–≤
        const wordLength = 4 + Math.floor(Math.random() * 2);
        let word = "";
        for (let i = 0; i < wordLength; i++) {
          const randomLetter =
            selectedLetters[Math.floor(Math.random() * selectedLetters.length)];
          word += randomLetter;
        }

        // –ö–æ–¥–∏—Ä—É–µ–º —Å–ª–æ–≤–æ
        let encodedMessage = "";
        for (const letter of word) {
          encodedMessage += selectedCodes[letter];
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
        const directFano = checkDirectFano(selectedCodes);
        const reverseFano = checkReverseFano(selectedCodes);

        currentTask = {
          setType: randomSet,
          symbols: codeSet.symbols,
          letters: selectedLetters,
          codes: selectedCodes,
          word: word,
          encodedMessage: encodedMessage,
          decodeDirection: directFano ? "start" : "end",
        };

        renderTask();
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è
      function renderTask() {
        // –¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è
        const symbolNames = {
          MORSE: "–∞–∑–±—É–∫–∏ –ú–æ—Ä–∑–µ (‚Ä¢ ‚Äî —Ç–æ—á–∫–∞, ‚Äì ‚Äî —Ç–∏—Ä–µ)",
          BINARY: "–¥–≤–æ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞ (0 –∏ 1)",
          PLUSMINUS: "–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (+ –∏ ‚Äì)",
          HASHAT: "–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (# –∏ @)",
          STARCARAT: "–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (* –∏ ^)",
        };

        const symbolName = symbolNames[currentTask.setType] || "–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è";

        let taskText = `–û—Ç —Ä–∞–∑–≤–µ–¥—á–∏–∫–∞ –±—ã–ª–∞ –ø–æ–ª—É—á–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Ä–∞–¥–∏–æ–≥—Ä–∞–º–º–∞, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ${symbolName}:<br><br>`;
        taskText += `–ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —Ä–∞–¥–∏–æ–≥—Ä–∞–º–º—ã –±—ã–ª–æ –ø–æ—Ç–µ—Ä—è–Ω–æ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –±—É–∫–≤—ã, –Ω–æ –∏–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ –≤ —Ä–∞–¥–∏–æ–≥—Ä–∞–º–º–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –±—É–∫–≤—ã:`;

        document.getElementById("taskText").innerHTML = taskText;

        // –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        document.getElementById("messageDisplay").textContent =
          currentTask.encodedMessage;

        // –¢–∞–±–ª–∏—Ü–∞ –∫–æ–¥–æ–≤
        const headerRow = document.getElementById("codesHeader");
        const lettersRow = document.getElementById("codesLetters");
        const valuesRow = document.getElementById("codesValues");

        headerRow.innerHTML = "";
        lettersRow.innerHTML = "";
        valuesRow.innerHTML = "";

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        const th = document.createElement("th");
        th.textContent = "–ë—É–∫–≤–∞ / –ö–æ–¥";
        headerRow.appendChild(th);

        // –Ø—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã
        currentTask.letters.forEach((letter) => {
          // –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–ø—É—Å—Ç–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–∞)
          // –ë—É–∫–≤–∞
          const letterTd = document.createElement("td");
          letterTd.className = "letter";
          letterTd.textContent = letter;
          lettersRow.appendChild(letterTd);

          // –ö–æ–¥
          const codeTd = document.createElement("td");
          codeTd.className = "code";
          codeTd.textContent = currentTask.codes[letter];
          valuesRow.appendChild(codeTd);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
        currentTask.letters.forEach(() => {
          const th = document.createElement("th");
          th.textContent = "";
          headerRow.appendChild(th);
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
        headerRow.innerHTML = "";
        currentTask.letters.forEach((letter, index) => {
          const th = document.createElement("th");
          th.textContent = letter;
          headerRow.appendChild(th);
        });

        // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏
        const tbody = document.querySelector("#codesTable tbody");
        tbody.innerHTML = "";

        // –°—Ç—Ä–æ–∫–∞ —Å –∫–æ–¥–∞–º–∏
        const codeRow = document.createElement("tr");
        currentTask.letters.forEach((letter) => {
          const td = document.createElement("td");
          td.className = "code";
          td.textContent = currentTask.codes[letter];
          codeRow.appendChild(td);
        });
        tbody.appendChild(codeRow);
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
      function showHint() {
        const hintBox = document.getElementById("hintBox");
        const directionHint = document.getElementById("directionHint");
        const hintSteps = document.getElementById("hintSteps");

        hintSteps.innerHTML = "";

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        const direction =
          currentTask.decodeDirection === "start" ? "—Å –Ω–∞—á–∞–ª–∞" : "—Å –∫–æ–Ω—Ü–∞";
        directionHint.textContent = `üí° –î–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ ${direction} —Å–æ–æ–±—â–µ–Ω–∏—è. –ù–∞–π–¥–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—á–∞–ª—É (–∏–ª–∏ –∫–æ–Ω—Ü—É) —Å–æ–æ–±—â–µ–Ω–∏—è.`;

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—à–∞–≥–æ–≤—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
        let remaining = currentTask.encodedMessage;
        let stepNum = 1;

        while (remaining.length > 0) {
          let found = false;

          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–¥—ã –ø–æ –¥–ª–∏–Ω–µ
          const sortedCodes = Object.entries(currentTask.codes).sort(
            (a, b) => a[1].length - b[1].length,
          );

          if (currentTask.decodeDirection === "start") {
            // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–∞—á–∞–ª–∞
            for (const [letter, code] of sortedCodes) {
              if (remaining.startsWith(code)) {
                const stepDiv = document.createElement("div");
                stepDiv.className = "hint-step";
                stepDiv.innerHTML = `<span class="code-part">${code}</span> ‚Üí <span class="letter-part">${letter}</span> | –æ—Å—Ç–∞–ª–æ—Å—å: <span class="remaining">${remaining.substring(code.length)}</span>`;
                hintSteps.appendChild(stepDiv);

                remaining = remaining.substring(code.length);
                found = true;
                stepNum++;
                break;
              }
            }
          } else {
            // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ü–∞
            for (const [letter, code] of sortedCodes) {
              if (remaining.endsWith(code)) {
                const stepDiv = document.createElement("div");
                stepDiv.className = "hint-step";
                stepDiv.innerHTML = `<span class="code-part">${code}</span> ‚Üí <span class="letter-part">${letter}</span> | –æ—Å—Ç–∞–ª–æ—Å—å: <span class="remaining">${remaining.substring(0, remaining.length - code.length)}</span>`;
                hintSteps.appendChild(stepDiv);

                remaining = remaining.substring(
                  0,
                  remaining.length - code.length,
                );
                found = true;
                stepNum++;
                break;
              }
            }
          }

          if (!found) break;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        const answerDiv = document.createElement("div");
        answerDiv.className = "hint-step";
        answerDiv.style.background = "rgba(25, 135, 84, 0.2)";
        answerDiv.innerHTML = `<strong>–û—Ç–≤–µ—Ç: <span class="letter-part">${currentTask.word}</span></strong>`;
        hintSteps.appendChild(answerDiv);

        hintBox.style.display = "block";
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
      function checkAnswer() {
        if (answered) return;

        const userAnswer = document
          .getElementById("answerInput")
          .value.toUpperCase()
          .trim();
        const correctAnswer = currentTask.word;

        if (!userAnswer) {
          alert("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç!");
          return;
        }

        answered = true;

        const input = document.getElementById("answerInput");
        const feedback = document.getElementById("feedback");
        const feedbackText = document.getElementById("feedbackText");

        if (userAnswer === correctAnswer) {
          input.className = "answer-input correct";
          feedback.className = "feedback correct";
          feedbackText.textContent = "üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ!";
        } else {
          input.className = "answer-input incorrect";
          feedback.className = "feedback incorrect";
          feedbackText.innerHTML = `‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.<br>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${correctAnswer}</strong>`;
        }

        feedback.style.display = "block";
      }

      // –°–±—Ä–æ—Å –∏–≥—Ä—ã
      function resetGame() {
        generateTask();
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
      document
        .getElementById("answerInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            checkAnswer();
          }
        });

      // –ó–∞–ø—É—Å–∫
      loadData();
    </script>
  </body>
</html>
