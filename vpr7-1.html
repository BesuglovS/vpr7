<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: white;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-size: 1.8rem;
      }

      .back-link {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 25px;
        margin-bottom: 20px;
        transition: background 0.3s;
      }

      .back-link:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .instructions {
        background: rgba(255, 255, 255, 0.9);
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1rem;
        color: #333;
      }

      .game-area {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .devices-pool {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .devices-pool h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.2rem;
        text-align: center;
      }

      .devices-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        min-height: 60px;
      }

      .device {
        background: linear-gradient(145deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 12px 18px;
        border-radius: 25px;
        cursor: grab;
        user-select: none;
        font-weight: 500;
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        touch-action: none;
      }

      .device:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
      }

      .device.dragging {
        opacity: 0.5;
        cursor: grabbing;
      }

      .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .category {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .category.drag-over {
        transform: scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        border: 3px dashed #667eea;
      }

      .category h3 {
        color: #333;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 2px solid #eee;
        font-size: 1rem;
      }

      .category-devices {
        min-height: 80px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 10px;
        border: 2px dashed #ddd;
        border-radius: 10px;
        background: #f9f9f9;
      }

      .device.correct {
        background: linear-gradient(
          145deg,
          #11998e 0%,
          #38ef7d 100%
        ) !important;
        box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4) !important;
      }

      .device.incorrect {
        background: linear-gradient(
          145deg,
          #eb3349 0%,
          #f45c43 100%
        ) !important;
        box-shadow: 0 4px 15px rgba(235, 51, 73, 0.4) !important;
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .score-board {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        margin-top: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .score {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
      }

      .score span {
        color: #667eea;
      }

      .btn-reset {
        background: linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1rem;
        cursor: pointer;
        margin-top: 15px;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .btn-reset:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .success-message {
        display: none;
        background: linear-gradient(145deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin-top: 20px;
        font-size: 1.3rem;
        font-weight: bold;
        animation: pulse 1s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 1.4rem;
        }

        .device {
          padding: 10px 14px;
          font-size: 0.9rem;
        }

        .category h3 {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="vpr7.html" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
      <h1>üéÆ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h1>

      <div class="instructions">
        –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à—å
        –∏–ª–∏ –ø–∞–ª–µ—Ü!
      </div>

      <div class="game-area">
        <div class="devices-pool">
          <h2>üì¶ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h2>
          <div class="devices-container" id="devicesPool"></div>
        </div>

        <div class="categories-grid" id="categoriesGrid"></div>
      </div>

      <div class="score-board">
        <div class="score">
          –ü—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="correctCount">0</span> /
          <span id="totalCount">0</span>
        </div>
        <button class="btn-reset" onclick="resetGame()">
          üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
        </button>
      </div>

      <div class="success-message" id="successMessage">
        üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
      </div>
    </div>

    <script>
      let categories = {};
      let selectedDevices = [];
      let correctAnswers = 0;
      let totalDevices = 0;
      let deviceCategories = {};

      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
      async function loadData() {
        try {
          const response = await fetch("vpr7-1.txt");
          const text = await response.text();
          parseData(text);
          initGame();
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
          // Fallback - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          const fallbackData = `@–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–≤–æ–¥–∞
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
–ú—ã—à—å
–°–∫–∞–Ω–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

@–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞
–ú–æ–Ω–∏—Ç–æ—Ä
–ü—Ä–∏–Ω—Ç–µ—Ä
–ù–∞—É—à–Ω–∏–∫–∏

@–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è
SSD (—Ç–≤–µ—Ä–¥–æ—Ç–µ–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å)
USB-—Ñ–ª–µ—à-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å (–§–ª–µ—à–∫–∞)

@–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä (CPU ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)`;
          parseData(fallbackData);
          initGame();
        }
      }

      // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
      function parseData(text) {
        const lines = text.split("\n");
        let currentCategory = "";

        lines.forEach((line) => {
          line = line.trim();
          if (line.startsWith("@")) {
            currentCategory = line.substring(1).trim();
            categories[currentCategory] = [];
          } else if (line && currentCategory) {
            categories[currentCategory].push(line);
          }
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
      function initGame() {
        // –í—ã–±–∏—Ä–∞–µ–º –ø–æ 2-3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤—Å–µ–≥–æ 9)
        selectedDevices = [];
        deviceCategories = {};

        const categoryNames = Object.keys(categories);
        const devicesPerCategory = [3, 2, 2, 2]; // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ 9 —É—Å—Ç—Ä–æ–π—Å—Ç–≤

        categoryNames.forEach((category, index) => {
          const devices = [...categories[category]];
          const count = devicesPerCategory[index] || 2;

          for (let i = 0; i < count && devices.length > 0; i++) {
            const randomIndex = Math.floor(Math.random() * devices.length);
            const device = devices.splice(randomIndex, 1)[0];
            selectedDevices.push(device);
            deviceCategories[device] = category;
          }
        });

        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        selectedDevices.sort(() => Math.random() - 0.5);

        totalDevices = selectedDevices.length;
        correctAnswers = 0;

        renderCategories();
        renderDevices();
        updateScore();
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
      function renderCategories() {
        const grid = document.getElementById("categoriesGrid");
        grid.innerHTML = "";

        Object.keys(categories).forEach((category) => {
          const categoryDiv = document.createElement("div");
          categoryDiv.className = "category";
          categoryDiv.dataset.category = category;

          categoryDiv.innerHTML = `
                    <h3>üìÅ ${category}</h3>
                    <div class="category-devices" data-category="${category}"></div>
                `;

          grid.appendChild(categoryDiv);

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è drop zone
          const dropZone = categoryDiv.querySelector(".category-devices");
          setupDropZone(dropZone, categoryDiv);
        });
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      function renderDevices() {
        const pool = document.getElementById("devicesPool");
        pool.innerHTML = "";

        selectedDevices.forEach((device) => {
          const deviceEl = createDeviceElement(device);
          pool.appendChild(deviceEl);
        });
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      function createDeviceElement(device) {
        const el = document.createElement("div");
        el.className = "device";
        el.textContent = device;
        el.draggable = true;
        el.dataset.device = device;

        // Drag events
        el.addEventListener("dragstart", handleDragStart);
        el.addEventListener("dragend", handleDragEnd);

        // Touch events
        el.addEventListener("touchstart", handleTouchStart, { passive: false });
        el.addEventListener("touchmove", handleTouchMove, { passive: false });
        el.addEventListener("touchend", handleTouchEnd);

        return el;
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drop zone
      function setupDropZone(dropZone, categoryDiv) {
        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          categoryDiv.classList.add("drag-over");
        });

        dropZone.addEventListener("dragleave", () => {
          categoryDiv.classList.remove("drag-over");
        });

        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          categoryDiv.classList.remove("drag-over");

          const deviceName = e.dataTransfer.getData("text/plain");
          const deviceEl = document.querySelector(
            `[data-device="${deviceName}"]`,
          );

          if (deviceEl) {
            handleDeviceDrop(deviceEl, dropZone, deviceName);
          }
        });
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ drop —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      function handleDeviceDrop(deviceEl, dropZone, deviceName) {
        const targetCategory = dropZone.dataset.category;
        const correctCategory = deviceCategories[deviceName];

        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const wasCorrect = deviceEl.classList.contains("correct");
        const wasIncorrect = deviceEl.classList.contains("incorrect");

        dropZone.appendChild(deviceEl);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
        if (targetCategory === correctCategory) {
          deviceEl.classList.remove("incorrect");
          deviceEl.classList.add("correct");
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –±—ã–ª —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
          if (!wasCorrect) {
            correctAnswers++;
          }
        } else {
          deviceEl.classList.remove("correct");
          deviceEl.classList.add("incorrect");
          // –£–º–µ–Ω—å—à–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –µ—Å–ª–∏ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º, –∞ —Å—Ç–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
          if (wasCorrect) {
            correctAnswers--;
          }
        }

        updateScore();
        checkWin();
      }

      // Drag handlers
      let draggedElement = null;

      function handleDragStart(e) {
        draggedElement = e.target;
        e.target.classList.add("dragging");
        e.dataTransfer.setData("text/plain", e.target.dataset.device);
      }

      function handleDragEnd(e) {
        e.target.classList.remove("dragging");
        draggedElement = null;
      }

      // Touch handlers
      let touchElement = null;
      let touchClone = null;
      let touchStartX, touchStartY;

      function handleTouchStart(e) {
        e.preventDefault();
        touchElement = e.target;
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;

        // –°–æ–∑–¥–∞–µ–º –∫–ª–æ–Ω –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        touchClone = touchElement.cloneNode(true);
        touchClone.style.position = "fixed";
        touchClone.style.zIndex = "1000";
        touchClone.style.pointerEvents = "none";
        touchClone.style.opacity = "0.8";
        touchClone.style.transform = "scale(1.1)";
        document.body.appendChild(touchClone);

        updateClonePosition(touch);
        touchElement.classList.add("dragging");
      }

      function handleTouchMove(e) {
        e.preventDefault();
        if (!touchClone) return;

        const touch = e.touches[0];
        updateClonePosition(touch);

        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º
        const categories = document.querySelectorAll(".category");
        categories.forEach((cat) => {
          const rect = cat.getBoundingClientRect();
          if (
            touch.clientX >= rect.left &&
            touch.clientX <= rect.right &&
            touch.clientY >= rect.top &&
            touch.clientY <= rect.bottom
          ) {
            cat.classList.add("drag-over");
          } else {
            cat.classList.remove("drag-over");
          }
        });
      }

      function handleTouchEnd(e) {
        if (!touchElement || !touchClone) return;

        const touch = e.changedTouches[0];

        // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º
        const dropZones = document.querySelectorAll(".category-devices");
        let targetZone = null;

        dropZones.forEach((zone) => {
          const rect = zone.getBoundingClientRect();
          if (
            touch.clientX >= rect.left &&
            touch.clientX <= rect.right &&
            touch.clientY >= rect.top &&
            touch.clientY <= rect.bottom
          ) {
            targetZone = zone;
          }
        });

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
        document.querySelectorAll(".category").forEach((cat) => {
          cat.classList.remove("drag-over");
        });

        if (targetZone) {
          const deviceName = touchElement.dataset.device;
          handleDeviceDrop(touchElement, targetZone, deviceName);
        }

        touchElement.classList.remove("dragging");
        touchClone.remove();
        touchClone = null;
        touchElement = null;
      }

      function updateClonePosition(touch) {
        if (touchClone) {
          touchClone.style.left =
            touch.clientX - touchClone.offsetWidth / 2 + "px";
          touchClone.style.top =
            touch.clientY - touchClone.offsetHeight / 2 + "px";
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
      function updateScore() {
        document.getElementById("correctCount").textContent = correctAnswers;
        document.getElementById("totalCount").textContent = totalDevices;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
      function checkWin() {
        const allPlaced =
          document.getElementById("devicesPool").children.length === 0;
        if (allPlaced && correctAnswers === totalDevices) {
          document.getElementById("successMessage").style.display = "block";
        } else {
          document.getElementById("successMessage").style.display = "none";
        }
      }

      // –°–±—Ä–æ—Å –∏–≥—Ä—ã
      function resetGame() {
        document.getElementById("successMessage").style.display = "none";
        categories = {};
        selectedDevices = [];
        correctAnswers = 0;
        loadData();
      }

      // –ó–∞–ø—É—Å–∫
      loadData();
    </script>
  </body>
</html>
